---
title: 'JavaScript - ë™ê¸°ì™€ ë¹„ë™ê¸°, Promise (async, await)'
category: 'JavaScript'
tags:
  - JavaScript
  - TIL
comments: true
toc: true
toc_sticky: true
draft: false
date: 2020-11-12
---

## ë™ê¸°ì™€ ë¹„ë™ê¸°

ë³´í†µì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œëŠ” ìœ„ì—ì„œ ì•„ë˜ë¡œ, ì‹¤í–‰í•œ ìˆœì„œëŒ€ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.

```js
console.log(1)
console.log(2)
console.log(3)
console.log(4)
/*
1
2
3
4
*/
```

ë™ê¸°ì ì¸ ì²˜ë¦¬ ë°©ì‹ìœ¼ë¡œ ì¸í•´ ìœ„ì˜ ì½”ë“œì˜ ì—°ì‚°ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€, ìˆœì°¨ì ìœ¼ë¡œ ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.

í•˜ì§€ë§Œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ë°ì´í„°ë¥¼ ìš”ì²­í–ˆì„ ë•Œ, ì„œë²„ê°€ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ë°›ì„ ë•Œê¹Œì§€ 10ì´ˆê°€ ê±¸ë¦°ë‹¤ë©´(..)

ë‹¤ìŒ ì½”ë“œëŠ” ì‹¤í–‰ë˜ê¸° ê¹Œì§€ 10ì´ˆë‚˜ ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤ë‹ˆ, ë„ˆë¬´ë‚˜ ë¹„íš¨ìœ¨ì ì´ê² ì£ !

```js
console.log(1)
setTimeout(() => console.log(2), 1000)
console.log(3)
/*
1
3
2
*/
```

ë³´í†µ ìš°ë¦¬ëŠ” ê·¸ëŸ° íë¦„ì—ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.

JavaScriptì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ Promiseì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë„ë¡ í•©ì‹œë‹¤!

<br>

## Promise

> **`Promise`** ê°ì²´ëŠ” ë¹„ë™ê¸° ì‘ì—…ì´ ë§ì´í•  ë¯¸ë˜ì˜ ì™„ë£Œ ë˜ëŠ” ì‹¤íŒ¨ì™€ ê·¸ ê²°ê³¼ ê°’ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

Promise ê°ì²´ëŠ” 3ê°€ì§€ì˜ ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

Promise ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ìš°ë¦¬ê°€ ì§€ì •í•œ operationì„ ìˆ˜í–‰ ì¤‘ì¼ ë•ŒëŠ” pending ìƒíƒœê°€ ë˜ê³ ,

ìš°ë¦¬ê°€ ì§€ì •í•œ operationì„ ì™„ì „íˆ ìˆ˜í–‰í•˜ê³  ë‚˜ì„œëŠ” ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ì´ ëë‹¤ë©´ fulfilled,

ì¤‘ê°„ì— ë¬¸ì œê°€ ìˆì—ˆë‹¤ë©´ rejected ìƒíƒœê°€ ë©ë‹ˆë‹¤!

ì‹¤ì œë¡œ Promiseë¥¼ ì‚¬ìš©í•´ë³´ë©´ì„œ ì¢€ ë” ì•Œì•„ë³´ë„ë¡ í•©ì‹œë‹¤

### Promise ìƒì„±

PromiseëŠ” í•¨ìˆ˜ì— ì½œë°±ì„ ì „ë‹¬í•˜ëŠ” ëŒ€ì‹ ì—, ì½œë°±ì„ ì²¨ë¶€í•˜ëŠ” ë°©ì‹ì˜ ê°ì²´ì…ë‹ˆë‹¤.

```js
const mypromise = new Promise((resolve, reject) => {
  console.log('ë­”ê°€ í—¤ë¹„í•œ ì¼')
  setTimeout(() => resolve('mengkki'), 2000)
})
```

ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ë™ì‘ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëì„ ë•Œ resolve()ë¥¼ í˜¸ì¶œí•˜ê³ , ì‹¤íŒ¨í–ˆì„ë•ŒëŠ” reject()ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

ìœ„ ì˜ˆì œì—ì„œëŠ” ë¹„ë™ê¸°ì ì¸ ì½”ë“œì˜ ì˜ˆë¥¼ ë“¤ê¸° ìœ„í•´ setTimeoutì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œëŠ” APIì½œê³¼ ê°™ì€ ë™ì‘ì´ ë“¤ì–´ê°€ê² ì£ !

### Promise ì‚¬ìš©

```js
mypromise.then(msg => console.log(msg))

/*
ë­”ê°€ í—¤ë¹„í•œ ì¼
mengkki
*/
```

promise ë’¤ì— thenì„ ì‚¬ìš©í•´ì„œ msgë¼ëŠ” ì¸ìë¥¼ ë¶ˆëŸ¬ì™”ëŠ”ë°ìš”,

ì—¬ê¸°ì„œ msgì—ëŠ” ìœ„ Promiseì—ì„œ resolveì— ì „ë‹¬í•œ ê°’ì´ ë“¤ì–´ê°€ê²Œ ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê²Œ ë˜ë©´

ë­”ê°€ í—¤ë¹„í•œ ì¼ << ì´ ê°€ì¥ ë¨¼ì € ì¶œë ¥ë˜ê³ , 2ì´ˆ í›„ mengkkiê°€ ì¶œë ¥ë©ë‹ˆë‹¤.

### rejectë¥¼ ì‚¬ìš©í•œ ê²½ìš°

```js
const mypromise = new Promise((resolve, reject) => {
  console.log('ë­”ê°€ í—¤ë¹„í•œ ì¼')
  setTimeout(() => reject(new Error('ì—ëŸ¬ë‚¬ë‹¤')), 2000)
})
mypromise.then(msg => console.log(msg))
```

ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì½˜ì†”ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

![](https://i.ibb.co/hLt5kS0/2020-11-13-10-55-17.png)

Uncaught ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

```js
mypromise.then(msg => console.log(msg)).catch(error => console.log(error))
```

ìœ„ ì½”ë“œë¥¼ ì´ë ‡ê²Œ ìˆ˜ì •í•´ì£¼ë©´ ì½˜ì†”ì— ì´ë ‡ê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

![](https://i.ibb.co/2YDnQSv/2020-11-13-11-03-46.png)

catchëŠ” promise ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ë¥¼ ì¡ì•„ë‚´ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

errorì¸ìë¡œ rejectì— ì „ë‹¬ëœ ì—ëŸ¬ë¥¼ ë°›ì•„ì™€ì„œ ì½˜ì†”ì— ì°ì–´ì¤€ ê²ƒì´ì£ !

#### ë²ˆì™¸) finally

```js
mypromise
  .then(msg => console.log(msg))
  .catch(error => console.log(error))
  .finally(() => console.log('íŒŒì´ë„ë¦¬'))
```

![](https://i.ibb.co/QQ2kNF6/2020-11-13-11-35-43.png)

finallyëŠ” promise ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë˜ë˜ ì—ëŸ¬ê°€ ë°œìƒí•˜ë˜ ìƒê´€ì—†ì´ ì‹¤í–‰ë©ë‹ˆë‹¤!

### Promise chaining

then ë‹¤ìŒì— catchê°€ .ìœ¼ë¡œ ì­‰ì­‰ ì´ì–´ì§€ê³  ìˆì£ ? ì´ê²ƒì„ promise chainì´ë¼ê³  í•˜ëŠ”ë°ìš”,

ë³´í†µ í•˜ë‚˜ë‚˜ ë‘ê°œ ì´ìƒì˜ ë¹„ë™ê¸° ì‘ì—…ì„ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰í•´ì•¼ í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

```js
const getNumber = new Promise((resolve, reject) => {
  setTimeout(() => resolve(1), 1000)
})

getNumber
  .then(num => num * 2)
  .then(num => num * 3)
  .then(
    num =>
      new Promise((resolve, reject) => {
        setTimeout(() => resolve(num - 3), 1000)
      })
  )
  .then(num => console.log(num)) // 3
```

ì²˜ìŒì— resolveë¡œ 1ì´ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— numì´ 1ì´ ë˜ê³ ,

ê·¸ í›„ 2, ê·¸ í›„ 6ì´ ë˜ì—ˆë‹¤ê°€ 3ì„ ë¹¼ë©´ì„œ ìµœì¢…ì ìœ¼ë¡œ 3ì´ ì½˜ì†”ì— ì°íˆê²Œ ë©ë‹ˆë‹¤.

```js
doSomeThing()
  .then(result => doSomethingElse(result))
  .then(newResult => doThirdThing(newResult))
  .then(finalResult => {
    console.log(`Got the final result: ${finalResult}`)
  })
  .catch(failureCallback)
```

then í•¨ìˆ˜ëŠ” ìƒˆë¡œìš´ promiseë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë’¤ì— .ìœ¼ë¡œ thenì´ë‚˜ catchê°™ì€ ê²ƒì„ ì­‰ì­‰ ì´ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

ì´ ì˜ˆì œì—ì„œëŠ” doSomeThingì´ ë¦¬í„´ë˜ë©´ ê·¸ ê°’ìœ¼ë¡œ doSomethingElseë¥¼ í˜¸ì¶œí•˜ê³  ë˜ ê·¸ ê²°ê³¼ë¡œ doThirdThing, ë§ˆì§€ë§‰ìœ¼ë¡œ finulResultë¥¼ ì½˜ì†”ì— ì°ê²Œ ë©ë‹ˆë‹¤.

ë§Œì•½ ë„ì¤‘ì— ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´ failureCallbackì„ ì‹¤í–‰í•˜ê²Œ ë˜ê² ë„¤ìš”!

> **ì¤‘ìš”:** ë°˜í™˜ê°’ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•©ë‹ˆë‹¤, ë§Œì•½ ì—†ë‹¤ë©´ ì½œë°± í•¨ìˆ˜ê°€ ì´ì „ì˜ promiseì˜ ê²°ê³¼ë¥¼ ë°›ì§€ ëª»í•©ë‹ˆë‹¤.
> (í™”ì‚´í‘œ í•¨ìˆ˜ () => xëŠ” () => {return x;}ì™€ ê°™ìŠµë‹ˆë‹¤).

<br>

## async, await

promise chainingì´ ì—°ì†ì ìœ¼ë¡œ ì´ì–´ì§€ë‹¤ë³´ë©´ ì½”ë“œê°€ ë‚œì¡í•˜ê²Œ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

asyncì™€ awaitì€ promiseë¥¼ ì¢€ë” ê°„í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” syntatic sugarì…ë‹ˆë‹¤!

### async

```js
function getUser() {
  return new Promise((resolve, reject) => {
    resolve('mengkki')
  })
}

const user = getUser()
user.then(user => console.log(user))
```

ê¸°ì¡´ì˜ promiseë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ì´ê±¸ asyncë¥¼ í™œìš©í•˜ê²Œ ëœë‹¤ë©´

```js
async function getUser() {
  return 'mengkki'
}

const user = getUser()
user.then(user => console.log(user))
```

ì§œì”! ì •ë§ ê°„í¸í•´ì¡Œì£ !

asyncê°€ ë¶™ì–´ìˆëŠ” í•¨ìˆ˜ì˜ ë¸”ëŸ­ ì•ˆì€ ìë™ì ìœ¼ë¡œ promiseê°€ ë©ë‹ˆë‹¤.

### await

```js
function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms))
}

async function getApple() {
  await delay(3000)
  return 'ğŸ'
}

async function getBanana() {
  await delay(3000)
  return 'ğŸŒ'
}
```

awaitì€ asyncí•¨ìˆ˜ ë‚´ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

awaitëŠ” async í•¨ìˆ˜ì˜ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€í•˜ê³  ì „ë‹¬ëœ promiseê°€ í’€ë¦´ë•Œê¹Œì§€ ê¸°ë‹¤ë¦° í›„ asyncí•¨ìˆ˜ì˜ ì‹¤í–‰ì„ ë‹¤ì‹œ ì‹œì‘í•˜ê³  ì™„ë£Œí›„ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

```js
async function getBanana() {
  await delay(3000)
  return 'ğŸŒ'
}

function getBanana2() {
  return delay(3000).then(() => 'ğŸŒ')
}
```

ìœ„ ì½”ë“œì™€ ì•„ë˜ì˜ ì½”ë“œëŠ” ê°™ì€ ì¼ì„ í•©ë‹ˆë‹¤.

ì´ë ‡ê²Œë§Œ ë´ì„œëŠ” awaitì´ ë­ê°€ ì¢‹ì€ì§€ ëª¨ë¥´ê² ì£ ..?í•˜ì§€ë§Œ... chainingì´ ë³µì¡í•´ì§„ë‹¤ë©´ ì´ì•¼ê¸°ëŠ” ë‹¬ë¼ì§‘ë‹ˆë‹¤.

```js
function pickFruits() {
  return getApple().then(apple => {
    return getBanana().then(banana => `${apple} + ${banana}`)
  })
}

async function pickFruits() {
  const apple = await getApple()
  const banana = await getBanana()
  return `${apple} + ${banana}`
}
```

ìœ„ ì½”ë“œì™€ ì•„ë˜ ì½”ë“œëŠ” í•˜ëŠ” ì¼ì€ ê°™ì§€ë§Œ ë°”ë¡œ ì°¨ì´ê°€ ë“œëŸ¬ë‚˜ì£ !

ëª¨ì–‘ìƒˆê°€ ê°„ë‹¨í•´ì§€ê¸´ í–ˆì§€ë§Œ ìœ„ ì½”ë“œëŠ” ì‚¬ê³¼ë¥¼ ë¨¼ì € ë°›ê³  ë°”ë‚˜ë‚˜ë¥¼ ë°›ê²Œ ë©ë‹ˆë‹¤.

ì‚¬ê³¼ë¥¼ ë°›ëŠ”ë° ë°”ë‚˜ë‚˜ê°€ í•„ìš”ì—†ê³ , ë°”ë‚˜ë‚˜ë¥¼ ë°›ëŠ” ë° ì‚¬ê³¼ê°€ í•„ìš”ì—†ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ë³‘ë ¬ì ìœ¼ë¡œ ìˆ˜ì •í•´ë³¼ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.

```js
function pickFruits() {
  return Promise.all([getApple(), getBanana()]).then(fruits =>
    fruits.join(' + ')
  )
}

pickFruits().then(console.log) // ğŸ + ğŸŒ
```

Promiseì˜ all APIë¥¼ ì´ìš©í•´ì„œ Promiseë“¤ì„ ë°°ì—´ì˜ í˜•íƒœë¡œ ë„£ì–´ì£¼ë©´ ë³‘ë ¬ì ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤!

```js
function pickFruits() {
  return Promise.race([getApple(), getBanana()])
}

pickFruits().then(console.log) // ğŸ
```

promiseì˜ race APIë¥¼ ì‚¬ìš©í•˜ë©´ ì£¼ì–´ì§„ promise ì¤‘ ê°€ì¥ ë¨¼ì € ëë‚˜ëŠ” ê²ƒì„ ë¦¬í„´í•˜ê²Œ ë©ë‹ˆë‹¤.

ì°¸ì¡°

[mdn promise]: https://developer.mozilla.org/ko/docs/Web/JavaScript/Guide/Using_promises

[MDN Promise]

[ë“œë¦¼ì½”ë”© ìœ íŠœë¸Œ]: https://www.youtube.com/watch?v=JB_yU6Oe2eE&list=PLv2d7VI9OotTVOL4QmPfvJWPJvkmv6h-2&index=12&ab_channel=%EB%93%9C%EB%A6%BC%EC%BD%94%EB%94%A9by%EC%97%98%EB%A6%AC

[ë“œë¦¼ì½”ë”© ìœ íŠœë¸Œ]
